{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"fluxopt","text":"<p>Energy system optimization with pyoframe \u2014 progressive modeling, from simple to complex.</p>"},{"location":"#installation","title":"Installation","text":"<pre><code>pip install fluxopt\n</code></pre>"},{"location":"#quick-example","title":"Quick Example","text":"<p>A gas boiler covers a heat demand, minimizing fuel cost:</p> <pre><code>from datetime import datetime\nfrom fluxopt import Bus, Converter, Effect, Flow, Port, solve\n\ntimesteps = [datetime(2024, 1, 1, h) for h in range(4)]\n\n# Flows\ngas_source = Flow(bus='gas', size=500, effects_per_flow_hour={'cost': 0.04})\nfuel = Flow(bus='gas', size=300)\nheat = Flow(bus='heat', size=200)\ndemand = Flow(bus='heat', size=100, fixed_relative_profile=[0.4, 0.7, 0.5, 0.6])\n\nresult = solve(\n    timesteps=timesteps,\n    buses=[Bus('gas'), Bus('heat')],\n    effects=[Effect('cost', is_objective=True)],\n    ports=[Port('grid', imports=[gas_source]), Port('demand', exports=[demand])],\n    converters=[Converter.boiler('boiler', thermal_efficiency=0.9, fuel_flow=fuel, thermal_flow=heat)],\n)\n\nprint(f\"Total cost: {result.objective_value:.2f}\")\nprint(result.flow_rates)\n</code></pre>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li>Guide \u2014 walkthrough of the full API, from flows to storage</li> <li>Math \u2014 formulation reference with notation, constraints, and examples</li> </ul>"},{"location":"guide/converters/","title":"Converters","text":"<p>A <code>Converter</code> enforces linear coupling between input and output flows. It models devices like boilers, heat pumps, and CHP plants.</p> <p>See Converters (Math) for the formulation.</p>"},{"location":"guide/converters/#factory-methods","title":"Factory Methods","text":""},{"location":"guide/converters/#boiler","title":"Boiler","text":"<p>Single input (fuel), single output (heat), with thermal efficiency:</p> <pre><code>from fluxopt import Converter, Flow\n\nfuel = Flow(bus='gas', size=300)\nheat = Flow(bus='heat', size=200)\n\nboiler = Converter.boiler('boiler', thermal_efficiency=0.9, fuel_flow=fuel, thermal_flow=heat)\n</code></pre> <p>This creates the conversion equation: <code>0.9 * P_gas - P_heat = 0</code>, so 10 MW gas input produces 9 MW heat.</p>"},{"location":"guide/converters/#heat-pump","title":"Heat Pump","text":"<p>Single input (electricity), single output (heat), with COP:</p> <pre><code>el = Flow(bus='elec', size=50)\nth = Flow(bus='heat', size=200)\n\nhp = Converter.heat_pump('hp', cop=3.5, electrical_flow=el, thermal_flow=th)\n</code></pre> <p>Conversion equation: <code>3.5 * P_el - P_heat = 0</code>.</p>"},{"location":"guide/converters/#chp-combined-heat-and-power","title":"CHP (Combined Heat and Power)","text":"<p>Single input (fuel), two outputs (electricity + heat). Two conversion equations, one per output:</p> <pre><code>fuel = Flow(bus='gas', size=100)\nel = Flow(bus='elec', size=50)\nth = Flow(bus='heat', size=60)\n\nchp = Converter.chp('chp', eta_el=0.4, eta_th=0.5,\n                     fuel_flow=fuel, electrical_flow=el, thermal_flow=th)\n</code></pre> <p>This produces two equations:</p> <ul> <li><code>0.4 * P_fuel - P_el = 0</code></li> <li><code>0.5 * P_fuel - P_heat = 0</code></li> </ul> <p>So 10 MW fuel input produces 4 MW electrical + 5 MW thermal.</p>"},{"location":"guide/converters/#custom-conversion-factors","title":"Custom Conversion Factors","text":"<p>For devices not covered by factory methods, pass <code>conversion_factors</code> directly. Each dict in the list is one conversion equation, mapping flows to their coefficients:</p> <pre><code>in1 = Flow(bus='a', size=100)\nin2 = Flow(bus='b', size=100)\nout = Flow(bus='c', size=100)\n\nconv = Converter(\n    id='custom',\n    inputs=[in1, in2],\n    outputs=[out],\n    conversion_factors=[{in1: 0.5, in2: 0.3, out: -1}],\n)\n</code></pre> <p>This enforces: <code>0.5 * P_a + 0.3 * P_b - P_c = 0</code>.</p>"},{"location":"guide/converters/#time-varying-coefficients","title":"Time-Varying Coefficients","text":"<p>Coefficients can vary per timestep (e.g., a heat pump with weather-dependent COP):</p> <pre><code>cop_profile = [3.2, 3.5, 3.8, 3.1]  # one value per timestep\nhp = Converter.heat_pump('hp', cop=cop_profile, electrical_flow=el, thermal_flow=th)\n</code></pre>"},{"location":"guide/converters/#full-example","title":"Full Example","text":"<p>Gas boiler serving a heat demand:</p> <pre><code>from datetime import datetime\nfrom fluxopt import Bus, Converter, Effect, Flow, Port, solve\n\ntimesteps = [datetime(2024, 1, 1, h) for h in range(4)]\ndemand = [40.0, 70.0, 50.0, 60.0]\n\ngas_source = Flow(bus='gas', size=500, effects_per_flow_hour={'cost': 0.04})\nfuel = Flow(bus='gas', size=300)\nheat = Flow(bus='heat', size=200)\ndemand_flow = Flow(bus='heat', size=100, fixed_relative_profile=[0.4, 0.7, 0.5, 0.6])\n\nresult = solve(\n    timesteps=timesteps,\n    buses=[Bus('gas'), Bus('heat')],\n    effects=[Effect('cost', is_objective=True)],\n    ports=[Port('grid', imports=[gas_source]), Port('demand', exports=[demand_flow])],\n    converters=[Converter.boiler('boiler', thermal_efficiency=0.9, fuel_flow=fuel, thermal_flow=heat)],\n)\n\n# Gas consumed = heat / efficiency\nprint(result.flow_rate('boiler(gas)'))\n</code></pre>"},{"location":"guide/effects/","title":"Effects","text":"<p>An <code>Effect</code> tracks a quantity (cost, CO2, primary energy, ...) across the optimization horizon. One effect is the objective to minimize; others can be bounded.</p> <p>See Effects (Math) for the formulation.</p>"},{"location":"guide/effects/#defining-effects","title":"Defining Effects","text":"<pre><code>from fluxopt import Effect\n\n# Objective effect (minimized)\ncost = Effect('cost', is_objective=True)\n\n# Tracked effect with a unit\nco2 = Effect('co2', unit='kg')\n</code></pre> <p>Exactly one effect must have <code>is_objective=True</code>.</p>"},{"location":"guide/effects/#linking-flows-to-effects","title":"Linking Flows to Effects","text":"<p>Flows contribute to effects via <code>effects_per_flow_hour</code>. The value is in effect-units per flow-hour (e.g., \u20ac/MWh):</p> <pre><code>from fluxopt import Flow\n\n# Single effect\ngas = Flow(bus='gas', size=500, effects_per_flow_hour={'cost': 0.04})\n\n# Multiple effects\ngas = Flow(bus='gas', size=500, effects_per_flow_hour={'cost': 0.04, 'co2': 0.2})\n</code></pre> <p>At each timestep, the contribution is <code>coefficient * flow_rate * dt</code>.</p>"},{"location":"guide/effects/#bounding-effects","title":"Bounding Effects","text":""},{"location":"guide/effects/#total-bounds","title":"Total Bounds","text":"<p>Limit the total effect over the entire horizon:</p> <pre><code># CO2 budget: max 1000 kg total\nco2 = Effect('co2', unit='kg', maximum_total=1000)\n\n# Cost floor (e.g., minimum revenue)\nrevenue = Effect('revenue', minimum_total=500)\n</code></pre>"},{"location":"guide/effects/#per-hour-bounds","title":"Per-Hour Bounds","text":"<p>Limit the effect value at each timestep:</p> <pre><code># Max 50 kg CO2 per hour\nco2 = Effect('co2', unit='kg', maximum_per_hour=50)\n\n# Time-varying per-hour bound\nco2 = Effect('co2', unit='kg', maximum_per_hour=[50, 40, 60, 50])\n</code></pre>"},{"location":"guide/effects/#accessing-results","title":"Accessing Results","text":"<p>After solving, the <code>SolvedModel</code> provides several views into effect values:</p> <pre><code>result = solve(...)\n\n# Total effect values (one row per effect)\nprint(result.effects)\n\n# Per-timestep effect values\nprint(result.effects_per_timestep)\n\n# Objective value (shortcut for the objective effect's total)\nprint(result.objective_value)\n\n# Per-source contributions: which flows contributed what to each effect\nprint(result.contributions)\n</code></pre>"},{"location":"guide/effects/#filtering-contributions","title":"Filtering Contributions","text":"<p>The <code>contributions</code> DataFrame has columns: <code>source</code>, <code>contributor</code>, <code>effect</code>, <code>time</code>, <code>solution</code>.</p> <pre><code># All flow contributions\nflow_contribs = result.contributions.filter(result.contributions['source'] == 'flow')\n\n# CO2 contributions only\nco2_contribs = result.contributions.filter(result.contributions['effect'] == 'co2')\n</code></pre>"},{"location":"guide/effects/#full-example","title":"Full Example","text":"<p>Two sources with different cost/CO2 tradeoffs, subject to an emission cap:</p> <pre><code>from datetime import datetime\nfrom fluxopt import Bus, Effect, Flow, Port, solve\n\ntimesteps = [datetime(2024, 1, 1, h) for h in range(3)]\n\ndemand = Flow(bus='elec', size=100, fixed_relative_profile=[0.5, 0.8, 0.6])\ncheap_dirty = Flow(bus='elec', size=200, effects_per_flow_hour={'cost': 0.02, 'co2': 1.0})\nexpensive_clean = Flow(bus='elec', size=200, effects_per_flow_hour={'cost': 0.10, 'co2': 0.0})\n\nresult = solve(\n    timesteps=timesteps,\n    buses=[Bus('elec')],\n    effects=[\n        Effect('cost', is_objective=True),\n        Effect('co2', maximum_total=100),\n    ],\n    ports=[\n        Port('cheap', imports=[cheap_dirty]),\n        Port('clean', imports=[expensive_clean]),\n        Port('demand', exports=[demand]),\n    ],\n)\n\nprint(f\"Total cost: {result.objective_value:.2f}\")\nprint(result.effects)\nprint(result.contributions)\n</code></pre>"},{"location":"guide/effects/#parameters-summary","title":"Parameters Summary","text":"Parameter Type Default Description <code>id</code> <code>str</code> required Effect identifier <code>unit</code> <code>str</code> <code>''</code> Unit label <code>is_objective</code> <code>bool</code> <code>False</code> Whether this effect is minimized <code>maximum_total</code> <code>float \\| None</code> <code>None</code> Upper bound on total <code>minimum_total</code> <code>float \\| None</code> <code>None</code> Lower bound on total <code>maximum_per_hour</code> <code>TimeSeries \\| None</code> <code>None</code> Upper bound per timestep <code>minimum_per_hour</code> <code>TimeSeries \\| None</code> <code>None</code> Lower bound per timestep"},{"location":"guide/flows/","title":"Flows","text":"<p>A <code>Flow</code> represents energy transfer on a bus. Flows are the building blocks \u2014 every port, converter, and storage is defined through its flows.</p> <p>See Flows (Math) for the formulation.</p>"},{"location":"guide/flows/#basic-construction","title":"Basic Construction","text":"<pre><code>from fluxopt import Flow\n\n# Minimal: just a bus\nf = Flow(bus='heat')\n\n# With capacity\nf = Flow(bus='heat', size=100)  # 100 MW nominal capacity\n</code></pre>"},{"location":"guide/flows/#sizing","title":"Sizing","text":"<p><code>size</code> sets the nominal capacity \\(\\bar{P}_f\\) in MW. When set, all relative parameters are scaled by this value:</p> <pre><code># Sized: flow rate bounded to [0, 100] MW\nf = Flow(bus='heat', size=100)\n\n# Unsized: flow rate bounded to [0, \u221e)\nf = Flow(bus='heat')\n</code></pre>"},{"location":"guide/flows/#bounds","title":"Bounds","text":"<p><code>relative_minimum</code> and <code>relative_maximum</code> set per-timestep bounds as fractions of <code>size</code>:</p> <pre><code># Minimum load 30%, maximum 100% \u2192 [30, 100] MW\nf = Flow(bus='heat', size=100, relative_minimum=0.3)\n\n# Time-varying maximum\nf = Flow(bus='heat', size=100, relative_maximum=[1.0, 0.8, 0.6, 1.0])\n</code></pre>"},{"location":"guide/flows/#fixed-profiles","title":"Fixed Profiles","text":"<p><code>fixed_relative_profile</code> pins the flow to an exact profile scaled by <code>size</code>:</p> <pre><code># Demand: 40, 70, 50, 60 MW\nf = Flow(bus='heat', size=100, fixed_relative_profile=[0.4, 0.7, 0.5, 0.6])\n</code></pre> <p>This sets both lower and upper bounds equal to the profile value.</p>"},{"location":"guide/flows/#effect-coefficients","title":"Effect Coefficients","text":"<p><code>effects_per_flow_hour</code> assigns cost or emission coefficients to a flow. Values are in units per flow-hour (e.g., \u20ac/MWh):</p> <pre><code># Constant cost\nf = Flow(bus='gas', size=500, effects_per_flow_hour={'cost': 0.04})\n\n# Multiple effects\nf = Flow(bus='gas', size=500, effects_per_flow_hour={'cost': 0.04, 'co2': 0.2})\n\n# Time-varying cost\nf = Flow(bus='gas', size=500, effects_per_flow_hour={'cost': [0.02, 0.08, 0.04]})\n</code></pre> <p>See Effects for how these coefficients feed into the objective and constraints.</p>"},{"location":"guide/flows/#id-qualification","title":"Id Qualification","text":"<p>Flow ids are auto-qualified by the parent component. You rarely need to set <code>id</code> explicitly:</p> <pre><code>from fluxopt import Port\n\nf = Flow(bus='elec')\nPort('grid', imports=[f])\n# f.id is now 'grid(elec)'\n</code></pre> <p>Set <code>id</code> to disambiguate when a component has multiple flows on the same bus:</p> <pre><code>f1 = Flow(bus='elec', id='base')\nf2 = Flow(bus='elec', id='peak')\nPort('plant', imports=[f1, f2])\n# f1.id = 'plant(base)', f2.id = 'plant(peak)'\n</code></pre>"},{"location":"guide/flows/#parameters-summary","title":"Parameters Summary","text":"Parameter Type Default Description <code>bus</code> <code>str</code> required Bus this flow connects to <code>id</code> <code>str</code> <code>''</code> Optional id (auto-qualified by parent) <code>size</code> <code>float \\| None</code> <code>None</code> Nominal capacity [MW] <code>relative_minimum</code> <code>TimeSeries</code> <code>0.0</code> Lower bound as fraction of size <code>relative_maximum</code> <code>TimeSeries</code> <code>1.0</code> Upper bound as fraction of size <code>fixed_relative_profile</code> <code>TimeSeries \\| None</code> <code>None</code> Fixed profile as fraction of size <code>effects_per_flow_hour</code> <code>dict[str, TimeSeries]</code> <code>{}</code> Effect coefficients per flow-hour"},{"location":"guide/getting-started/","title":"Getting Started","text":"<p>This walkthrough builds a simple heat system end to end: define components, solve, and inspect results.</p>"},{"location":"guide/getting-started/#the-system","title":"The System","text":"<p>A gas boiler supplies heat to meet a demand profile. We minimize fuel cost.</p> <pre><code>gas bus \u2500\u2500\u25b6 [boiler \u03b7=0.9] \u2500\u2500\u25b6 heat bus \u2500\u2500\u25b6 demand\n   \u25b2\n   \u2502\n grid (gas source, 0.04 \u20ac/kWh)\n</code></pre>"},{"location":"guide/getting-started/#step-by-step","title":"Step by Step","text":""},{"location":"guide/getting-started/#1-imports-and-timesteps","title":"1. Imports and Timesteps","text":"<pre><code>from datetime import datetime\nfrom fluxopt import Bus, Converter, Effect, Flow, Port, solve\n\ntimesteps = [datetime(2024, 1, 1, h) for h in range(4)]\n</code></pre> <p>Timesteps can be <code>datetime</code> objects or plain integers. The duration <code>dt</code> is inferred from consecutive timestamps (here 1 h each).</p>"},{"location":"guide/getting-started/#2-define-buses","title":"2. Define Buses","text":"<p>Buses are energy carriers \u2014 nodes where flows must balance.</p> <pre><code>buses = [Bus('gas'), Bus('heat')]\n</code></pre>"},{"location":"guide/getting-started/#3-define-effects","title":"3. Define Effects","text":"<p>Effects track quantities across the horizon. Mark one as the objective.</p> <pre><code>effects = [Effect('cost', is_objective=True)]\n</code></pre>"},{"location":"guide/getting-started/#4-define-flows","title":"4. Define Flows","text":"<p>Flows carry energy on a bus. Each flow has a <code>size</code> (nominal capacity) and optional parameters like <code>fixed_relative_profile</code> or <code>effects_per_flow_hour</code>.</p> <pre><code># Gas source: up to 500 MW, costs 0.04 \u20ac/kWh\ngas_source = Flow(bus='gas', size=500, effects_per_flow_hour={'cost': 0.04})\n\n# Boiler fuel input and heat output\nfuel = Flow(bus='gas', size=300)\nheat = Flow(bus='heat', size=200)\n\n# Heat demand: 100 MW capacity, profile sets actual demand per timestep\ndemand = Flow(bus='heat', size=100, fixed_relative_profile=[0.4, 0.7, 0.5, 0.6])\n</code></pre>"},{"location":"guide/getting-started/#5-define-ports-and-converters","title":"5. Define Ports and Converters","text":"<p>Ports connect flows to the outside world (sources and sinks). Converters couple input and output flows with conversion equations.</p> <pre><code>ports = [\n    Port('grid', imports=[gas_source]),\n    Port('demand', exports=[demand]),\n]\n\nconverters = [\n    Converter.boiler('boiler', thermal_efficiency=0.9, fuel_flow=fuel, thermal_flow=heat),\n]\n</code></pre>"},{"location":"guide/getting-started/#6-solve","title":"6. Solve","text":"<pre><code>result = solve(\n    timesteps=timesteps,\n    buses=buses,\n    effects=effects,\n    ports=ports,\n    converters=converters,\n)\n</code></pre>"},{"location":"guide/getting-started/#7-inspect-results","title":"7. Inspect Results","text":"<pre><code># Objective value (total cost)\nprint(result.objective_value)\n\n# Flow rates for a specific flow\nprint(result.flow_rate('boiler(gas)'))\n\n# All flow rates\nprint(result.flow_rates)\n\n# Effect totals\nprint(result.effects)\n\n# Per-timestep effects\nprint(result.effects_per_timestep)\n\n# Per-source contributions (which flows contributed to which effects)\nprint(result.contributions)\n</code></pre> <p>Flow ids are qualified as <code>{component}({bus_or_id})</code> \u2014 e.g., <code>boiler(gas)</code>, <code>grid(gas)</code>, <code>demand(heat)</code>.</p>"},{"location":"guide/getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>Flows \u2014 sizing, bounds, profiles, effect coefficients</li> <li>Converters \u2014 boiler, heat pump, CHP, custom conversion</li> <li>Storage \u2014 batteries, thermal storage</li> <li>Effects \u2014 multi-effect tracking, bounds, contributions</li> </ul>"},{"location":"guide/storage/","title":"Storage","text":"<p>A <code>Storage</code> models energy storage with charge/discharge flows, capacity, efficiency, and self-discharge.</p> <p>See Storage (Math) for the formulation.</p>"},{"location":"guide/storage/#basic-construction","title":"Basic Construction","text":"<p>A storage needs two flows (charging and discharging) on the same bus:</p> <pre><code>from fluxopt import Flow, Storage\n\ncharge = Flow(bus='elec', size=50)     # max charge rate 50 MW\ndischarge = Flow(bus='elec', size=50)  # max discharge rate 50 MW\n\nbattery = Storage('battery', charging=charge, discharging=discharge, capacity=100.0)\n</code></pre> <p>Flow ids are auto-qualified: <code>battery(charge)</code> and <code>battery(discharge)</code>.</p>"},{"location":"guide/storage/#parameters","title":"Parameters","text":""},{"location":"guide/storage/#capacity","title":"Capacity","text":"<p><code>capacity</code> sets the maximum stored energy \\(\\bar{E}_s\\) in MWh:</p> <pre><code>battery = Storage('battery', charging=charge, discharging=discharge, capacity=100.0)\n</code></pre>"},{"location":"guide/storage/#efficiency","title":"Efficiency","text":"<p><code>eta_charge</code> and <code>eta_discharge</code> set round-trip efficiency. Losses are applied during charging and discharging respectively:</p> <pre><code>battery = Storage(\n    'battery', charging=charge, discharging=discharge,\n    capacity=100.0,\n    eta_charge=0.95,\n    eta_discharge=0.95,\n)\n</code></pre> <p>With these values, a full charge/discharge cycle retains 90.25% of the energy.</p>"},{"location":"guide/storage/#self-discharge","title":"Self-Discharge","text":"<p><code>relative_loss_per_hour</code> sets the fraction of stored energy lost per hour:</p> <pre><code>battery = Storage(\n    'battery', charging=charge, discharging=discharge,\n    capacity=100.0,\n    relative_loss_per_hour=0.001,  # 0.1%/h\n)\n</code></pre>"},{"location":"guide/storage/#initial-charge-state","title":"Initial Charge State","text":"<p><code>initial_charge_state</code> sets the energy level at the start of the horizon:</p> <pre><code># Fixed initial state (absolute MWh)\nbattery = Storage(..., initial_charge_state=50.0)\n\n# Fraction of capacity (values &lt;= 1 are interpreted as fractions)\nbattery = Storage(..., initial_charge_state=0.5)  # 50% of capacity\n\n# Cyclic: end state must equal start state\nbattery = Storage(..., initial_charge_state='cyclic')\n</code></pre> <p>The default is <code>0.0</code> (empty).</p>"},{"location":"guide/storage/#charge-state-bounds","title":"Charge State Bounds","text":"<p><code>relative_minimum_charge_state</code> and <code>relative_maximum_charge_state</code> limit the SOC as fractions of capacity:</p> <pre><code>battery = Storage(\n    'battery', charging=charge, discharging=discharge,\n    capacity=100.0,\n    relative_minimum_charge_state=0.2,  # never below 20%\n    relative_maximum_charge_state=0.9,  # never above 90%\n)\n</code></pre>"},{"location":"guide/storage/#full-example","title":"Full Example","text":"<p>Battery arbitrage \u2014 charge in cheap hours, discharge in expensive hours:</p> <pre><code>from datetime import datetime\nfrom fluxopt import Bus, Effect, Flow, Port, Storage, solve\n\ntimesteps = [datetime(2024, 1, 1, h) for h in range(4)]\nprices = [0.02, 0.08, 0.02, 0.08]\n\nsource = Flow(bus='elec', size=200, effects_per_flow_hour={'cost': prices})\ndemand = Flow(bus='elec', size=100, fixed_relative_profile=[0.5, 0.5, 0.5, 0.5])\n\ncharge = Flow(bus='elec', size=50)\ndischarge = Flow(bus='elec', size=50)\nbattery = Storage('battery', charging=charge, discharging=discharge, capacity=100.0)\n\nresult = solve(\n    timesteps=timesteps,\n    buses=[Bus('elec')],\n    effects=[Effect('cost', is_objective=True)],\n    ports=[Port('grid', imports=[source]), Port('demand', exports=[demand])],\n    storages=[battery],\n)\n\nprint(result.flow_rate('battery(charge)'))\nprint(result.flow_rate('battery(discharge)'))\nprint(result.charge_state('battery'))\n</code></pre>"},{"location":"guide/storage/#parameters-summary","title":"Parameters Summary","text":"Parameter Type Default Description <code>id</code> <code>str</code> required Storage identifier <code>charging</code> <code>Flow</code> required Charging flow <code>discharging</code> <code>Flow</code> required Discharging flow <code>capacity</code> <code>float \\| None</code> <code>None</code> Maximum stored energy [MWh] <code>eta_charge</code> <code>TimeSeries</code> <code>1.0</code> Charging efficiency <code>eta_discharge</code> <code>TimeSeries</code> <code>1.0</code> Discharging efficiency <code>relative_loss_per_hour</code> <code>TimeSeries</code> <code>0.0</code> Self-discharge rate [1/h] <code>initial_charge_state</code> <code>float \\| str \\| None</code> <code>0.0</code> Initial energy or <code>'cyclic'</code> <code>relative_minimum_charge_state</code> <code>TimeSeries</code> <code>0.0</code> Min SOC as fraction of capacity <code>relative_maximum_charge_state</code> <code>TimeSeries</code> <code>1.0</code> Max SOC as fraction of capacity"},{"location":"math/bus-balance/","title":"Bus Balance","text":""},{"location":"math/bus-balance/#formulation","title":"Formulation","text":"<p>Every bus \\(b\\) must be balanced at every timestep \u2014 total outflow equals total inflow:</p> \\[ \\sum_{f \\in \\mathcal{F}_b^{\\text{out}}} P_{f,t} - \\sum_{f \\in \\mathcal{F}_b^{\\text{in}}} P_{f,t} = 0 \\quad \\forall \\, b \\in \\mathcal{B}, \\; t \\in \\mathcal{T} \\] <p>where:</p> <ul> <li>\\(\\mathcal{F}_b^{\\text{out}}\\) \u2014 flows that produce into bus \\(b\\) (imports of ports and outputs of converters)</li> <li>\\(\\mathcal{F}_b^{\\text{in}}\\) \u2014 flows that consume from bus \\(b\\) (exports of ports and inputs of converters)</li> </ul> <p>The sign convention uses coefficients: \\(+1\\) for flows producing into the bus and \\(-1\\) for flows consuming from the bus. The constraint is then:</p> \\[ \\sum_{f \\in \\mathcal{F}_b} \\text{coeff}_{b,f} \\cdot P_{f,t} = 0 \\quad \\forall \\, b, t \\]"},{"location":"math/bus-balance/#parameters","title":"Parameters","text":"Symbol Description Reference \\(\\mathcal{F}_b^{\\text{out}}\\) Flows producing into bus \\(b\\) Flows with <code>_is_input=False</code> connected to bus \\(\\mathcal{F}_b^{\\text{in}}\\) Flows consuming from bus \\(b\\) Flows with <code>_is_input=True</code> connected to bus \\(P_{f,t}\\) Flow rate variable <code>flow_rate[flow, time]</code> <p>See Notation for the full symbol table.</p>"},{"location":"math/bus-balance/#example","title":"Example","text":"<p>A thermal bus with a boiler output (3 MW) and a demand input (3 MW):</p> \\[ \\underbrace{P_{\\text{boiler\\_th},t}}_{+1 \\times 3} + \\underbrace{(-1) \\cdot P_{\\text{demand},t}}_{-1 \\times 3} = 0 \\quad \\checkmark \\]"},{"location":"math/converters/","title":"Linear Conversion","text":""},{"location":"math/converters/#formulation","title":"Formulation","text":"<p>A <code>Converter</code> enforces linear coupling between its input and output flows. Each conversion equation requires:</p> \\[ \\sum_{f} a_{f} \\cdot P_{f,t} = 0 \\quad \\forall \\, \\text{converter}, \\; \\text{eq\\_idx}, \\; t \\in \\mathcal{T} \\] <p>where \\(a_f\\) is the conversion coefficient for flow \\(f\\). A converter can have multiple equations (one per row in <code>conversion_factors</code>), allowing multi-output devices like CHP plants.</p>"},{"location":"math/converters/#parameters","title":"Parameters","text":"Symbol Description Reference \\(a_f\\) Conversion coefficient <code>Converter.conversion_factors</code> \\(P_{f,t}\\) Flow rate variable <code>flow_rate[flow, time]</code> <p>See Notation for the full symbol table.</p>"},{"location":"math/converters/#examples","title":"Examples","text":""},{"location":"math/converters/#boiler","title":"Boiler","text":"<p>A gas boiler with thermal efficiency \\(\\eta_{\\text{th}} = 0.9\\):</p> \\[ \\eta_{\\text{th}} \\cdot P_{\\text{gas},t} - P_{\\text{th},t} = 0 \\] \\[ 0.9 \\cdot P_{\\text{gas},t} = P_{\\text{th},t} \\] <p>So 10 MW gas input produces 9 MW thermal output.</p> <pre><code>Converter.boiler(\"boiler\", thermal_efficiency=0.9, fuel_flow=gas, thermal_flow=th)\n# conversion_factors = [{gas.id: 0.9, th.id: -1}]\n</code></pre>"},{"location":"math/converters/#heat-pump","title":"Heat Pump","text":"<p>A heat pump with COP = 3.5:</p> \\[ \\text{COP} \\cdot P_{\\text{el},t} - P_{\\text{th},t} = 0 \\] \\[ 3.5 \\cdot P_{\\text{el},t} = P_{\\text{th},t} \\] <p>So 1 MW electrical input produces 3.5 MW thermal output.</p> <pre><code>Converter.heat_pump(\"hp\", cop=3.5, electrical_flow=el, thermal_flow=th)\n# conversion_factors = [{el.id: 3.5, th.id: -1}]\n</code></pre>"},{"location":"math/converters/#chp-combined-heat-and-power","title":"CHP (Combined Heat and Power)","text":"<p>A CHP with \\(\\eta_{\\text{el}} = 0.4\\) and \\(\\eta_{\\text{th}} = 0.5\\) has two conversion equations:</p> \\[ \\eta_{\\text{el}} \\cdot P_{\\text{fuel},t} - P_{\\text{el},t} = 0 \\] \\[ \\eta_{\\text{th}} \\cdot P_{\\text{fuel},t} - P_{\\text{th},t} = 0 \\] <p>So 10 MW fuel input produces 4 MW electrical + 5 MW thermal.</p> <pre><code>Converter.chp(\"chp\", eta_el=0.4, eta_th=0.5,\n                     fuel_flow=fuel, electrical_flow=el, thermal_flow=th)\n# conversion_factors = [\n#     {fuel.id: 0.4, el.id: -1},\n#     {fuel.id: 0.5, th.id: -1},\n# ]\n</code></pre>"},{"location":"math/converters/#time-varying-coefficients","title":"Time-Varying Coefficients","text":"<p>Conversion coefficients can be time-varying (e.g., a heat pump with hourly COP from weather data). Pass a list or array instead of a scalar:</p> <pre><code>cop_profile = [3.2, 3.5, 3.8, 3.1]  # one value per timestep\nConverter.heat_pump(\"hp\", cop=cop_profile, electrical_flow=el, thermal_flow=th)\n</code></pre>"},{"location":"math/effects/","title":"Effect Tracking &amp; Bounding","text":""},{"location":"math/effects/#overview","title":"Overview","text":"<p>Effects represent quantities that are tracked across the optimization horizon (e.g., cost, CO\u2082 emissions, primary energy). One effect is designated as the objective to minimize.</p>"},{"location":"math/effects/#per-timestep-tracking","title":"Per-Timestep Tracking","text":"<p>Each effect accumulates contributions from all flows at each timestep:</p> \\[ \\Phi_{k,t} = \\sum_{f \\in \\mathcal{F}} c_{f,k,t} \\cdot P_{f,t} \\cdot \\Delta t_t \\quad \\forall \\, k \\in \\mathcal{K}, \\; t \\in \\mathcal{T} \\] <p>The coefficient \\(c_{f,k,t}\\) specifies how much of effect \\(k\\) is produced per flow-hour of flow \\(f\\) (e.g., \u20ac/MWh for cost, kg/MWh for emissions).</p>"},{"location":"math/effects/#total-aggregation","title":"Total Aggregation","text":"<p>The total effect sums per-timestep values with optional weights:</p> \\[ \\Phi_k = \\sum_{t \\in \\mathcal{T}} \\Phi_{k,t} \\cdot w_t \\quad \\forall \\, k \\in \\mathcal{K} \\] <p>Weights \\(w_t\\) allow scaling timesteps (e.g., a representative week scaled to a year).</p>"},{"location":"math/effects/#total-bounds","title":"Total Bounds","text":"<p>Upper and lower bounds on the total effect over the entire horizon:</p> \\[ \\underline{\\Phi}_k \\leq \\Phi_k \\leq \\bar{\\Phi}_k \\] <p>This is useful for emission caps or budget constraints.</p>"},{"location":"math/effects/#per-timestep-bounds","title":"Per-Timestep Bounds","text":"<p>Bounds on the effect value at each timestep:</p> \\[ \\underline{\\Phi}_{k,t} \\leq \\Phi_{k,t} \\leq \\bar{\\Phi}_{k,t} \\quad \\forall \\, t \\in \\mathcal{T} \\] <p>This enforces per-hour limits (e.g., maximum hourly emissions).</p>"},{"location":"math/effects/#parameters","title":"Parameters","text":"Symbol Description Reference \\(\\Phi_{k,t}\\) Per-timestep effect variable <code>effect_per_timestep[effect, time]</code> \\(\\Phi_k\\) Total effect variable <code>effect_total[effect]</code> \\(c_{f,k,t}\\) Effect coefficient per flow-hour <code>Flow.effects_per_flow_hour</code> \\(P_{f,t}\\) Flow rate variable <code>flow_rate[flow, time]</code> \\(\\Delta t_t\\) Timestep duration dt \\(w_t\\) Timestep weight weights \\(\\bar{\\Phi}_k\\) Maximum total <code>Effect.maximum_total</code> \\(\\underline{\\Phi}_k\\) Minimum total <code>Effect.minimum_total</code> \\(\\bar{\\Phi}_{k,t}\\) Maximum per hour <code>Effect.maximum_per_hour</code> \\(\\underline{\\Phi}_{k,t}\\) Minimum per hour <code>Effect.minimum_per_hour</code> <p>See Notation for the full symbol table.</p>"},{"location":"math/effects/#example","title":"Example","text":"<p>A system with two effects \u2014 cost (objective) and CO\u2082 (capped at 1000 kg):</p> <pre><code>effects = [\n    Effect(\"cost\", unit=\"\u20ac\", is_objective=True),\n    Effect(\"CO2\", unit=\"kg\", maximum_total=1000),\n]\n</code></pre> <p>A gas flow with both effect coefficients:</p> <pre><code>gas_flow = Flow(\"gas\", bus=\"gas_bus\", effects_per_flow_hour={\"cost\": 30, \"CO2\": 0.2})\n</code></pre> <p>At timestep \\(t\\) with \\(P_{\\text{gas},t} = 5\\) MW and \\(\\Delta t = 1\\) h:</p> <ul> <li>\\(\\Phi_{\\text{cost},t} = 30 \\times 5 \\times 1 = 150\\) \u20ac</li> <li>\\(\\Phi_{\\text{CO\u2082},t} = 0.2 \\times 5 \\times 1 = 1.0\\) kg</li> </ul>"},{"location":"math/flows/","title":"Flows","text":"<p>A flow represents energy transfer on a bus. This page covers the full mathematical model: sizing, bounds, fixed profiles, and effect contributions.</p>"},{"location":"math/flows/#flow-rate-variable","title":"Flow Rate Variable","text":"<p>Each flow \\(f\\) has a non-negative rate variable \\(P_{f,t}\\) at each timestep:</p> \\[ P_{f,t} \\geq 0 \\quad \\forall \\, f \\in \\mathcal{F}, \\; t \\in \\mathcal{T} \\]"},{"location":"math/flows/#sizing","title":"Sizing","text":"<p>The nominal capacity \\(\\bar{P}_f\\) (<code>Flow.size</code>) sets the scale for all relative parameters. When no capacity is specified (\\(\\bar{P}_f = \\infty\\)), the flow is unbounded above.</p>"},{"location":"math/flows/#bounds","title":"Bounds","text":""},{"location":"math/flows/#sized-flows","title":"Sized Flows","text":"<p>When a flow has a nominal capacity \\(\\bar{P}_f\\), the flow rate is bounded by relative minimum and maximum profiles:</p> \\[ \\bar{P}_f \\cdot \\underline{p}_{f,t} \\leq P_{f,t} \\leq \\bar{P}_f \\cdot \\bar{p}_{f,t} \\quad \\forall \\, f, t \\] <p>By default, \\(\\underline{p}_{f,t} = 0\\) and \\(\\bar{p}_{f,t} = 1\\), so the bounds simplify to \\(0 \\leq P_{f,t} \\leq \\bar{P}_f\\).</p>"},{"location":"math/flows/#unsized-flows","title":"Unsized Flows","text":"<p>When no capacity is specified (\\(\\bar{P}_f = \\infty\\)), the flow is unbounded above:</p> \\[ 0 \\leq P_{f,t} \\quad \\forall \\, f, t \\]"},{"location":"math/flows/#fixed-profile","title":"Fixed Profile","text":"<p>When <code>Flow.fixed_relative_profile</code> (\\(\\pi_{f,t}\\)) is set, the flow rate is fixed to a profile scaled by the capacity:</p> \\[ P_{f,t} = \\bar{P}_f \\cdot \\pi_{f,t} \\quad \\forall \\, f, t \\] <p>This is implemented by setting both lower and upper bounds equal to the profile value.</p>"},{"location":"math/flows/#effect-contributions","title":"Effect Contributions","text":"<p>Each flow can contribute to tracked effects (cost, emissions, ...). The per-timestep contribution of flow \\(f\\) to effect \\(k\\) is:</p> \\[ c_{f,k,t} \\cdot P_{f,t} \\cdot \\Delta t_t \\] <p>where \\(c_{f,k,t}\\) is the effect coefficient per flow-hour (<code>Flow.effects_per_flow_hour</code>). These contributions feed into the effect tracking equations.</p>"},{"location":"math/flows/#parameters","title":"Parameters","text":"Symbol Description Reference \\(P_{f,t}\\) Flow rate variable <code>flow_rate[flow, time]</code> \\(\\bar{P}_f\\) Nominal capacity <code>Flow.size</code> \\(\\underline{p}_{f,t}\\) Relative lower bound <code>Flow.relative_minimum</code> \\(\\bar{p}_{f,t}\\) Relative upper bound <code>Flow.relative_maximum</code> \\(\\pi_{f,t}\\) Fixed relative profile <code>Flow.fixed_relative_profile</code> \\(c_{f,k,t}\\) Effect coefficient per flow-hour <code>Flow.effects_per_flow_hour</code> \\(\\Delta t_t\\) Timestep duration dt <p>See Notation for the full symbol table.</p>"},{"location":"math/flows/#examples","title":"Examples","text":""},{"location":"math/flows/#sized-flow-with-minimum-load","title":"Sized Flow with Minimum Load","text":"<p>A boiler with capacity \\(\\bar{P} = 10\\) MW, minimum load \\(\\underline{p} = 0.3\\), maximum load \\(\\bar{p} = 1.0\\):</p> \\[ 10 \\times 0.3 \\leq P_t \\leq 10 \\times 1.0 \\quad \\Rightarrow \\quad 3 \\leq P_t \\leq 10 \\; \\text{MW} \\]"},{"location":"math/flows/#fixed-demand-profile","title":"Fixed Demand Profile","text":"<p>A demand of 100 MW capacity with profile \\(\\pi = [0.4, 0.7, 0.5, 0.6]\\):</p> \\[ P_t = 100 \\cdot \\pi_t \\quad \\Rightarrow \\quad P = [40, 70, 50, 60] \\; \\text{MW} \\]"},{"location":"math/flows/#effect-contribution","title":"Effect Contribution","text":"<p>A gas flow with cost coefficient \\(c = 0.04\\) \u20ac/MWh, rate \\(P = 5\\) MW, duration \\(\\Delta t = 1\\) h:</p> \\[ 0.04 \\times 5 \\times 1 = 0.2 \\; \\text{\u20ac} \\]"},{"location":"math/notation/","title":"Notation","text":"<p>This page defines the canonical symbols used throughout the mathematical formulation. Each symbol maps to a specific field or variable in the code.</p>"},{"location":"math/notation/#sets-indices","title":"Sets &amp; Indices","text":"Symbol Description Code \\(t \\in \\mathcal{T}\\) Timesteps <code>time</code> dimension \\(f \\in \\mathcal{F}\\) Flows <code>flow</code> dimension \\(b \\in \\mathcal{B}\\) Buses <code>bus</code> dimension \\(s \\in \\mathcal{S}\\) Storages <code>storage</code> dimension \\(k \\in \\mathcal{K}\\) Effects (cost, CO\u2082, \u2026) <code>effect</code> dimension"},{"location":"math/notation/#variables","title":"Variables","text":"Symbol Code Domain Unit Description \\(P_{f,t}\\) <code>flow_rate[flow, time]</code> \\(\\geq 0\\) MW Flow rate \\(E_{s,t}\\) <code>charge_state[storage, time]</code> \\(\\geq 0\\) MWh Stored energy \\(\\Phi_{k,t}\\) <code>effect_per_timestep[effect, time]</code> \\(\\mathbb{R}\\) varies Per-timestep effect \\(\\Phi_k\\) <code>effect_total[effect]</code> \\(\\mathbb{R}\\) varies Total effect over horizon"},{"location":"math/notation/#parameters","title":"Parameters","text":"Symbol Code Domain Unit Description \\(\\bar{P}_f\\) <code>Flow.size</code> \\(\\geq 0\\) or \\(\\infty\\) MW Nominal capacity \\(\\underline{p}_{f,t}\\) <code>Flow.relative_minimum</code> \\([0, 1]\\) \u2014 Relative lower bound \\(\\bar{p}_{f,t}\\) <code>Flow.relative_maximum</code> \\([0, 1]\\) \u2014 Relative upper bound \\(\\pi_{f,t}\\) <code>Flow.fixed_relative_profile</code> \\([0, 1]\\) \u2014 Fixed profile \\(c_{f,k,t}\\) <code>Flow.effects_per_flow_hour</code> \\(\\mathbb{R}\\) varies Effect coefficient per flow-hour \\(\\bar{E}_s\\) <code>Storage.capacity</code> \\(\\geq 0\\) MWh Storage capacity \\(\\eta^{\\text{c}}_s\\) <code>Storage.eta_charge</code> \\((0, 1]\\) \u2014 Charging efficiency \\(\\eta^{\\text{d}}_s\\) <code>Storage.eta_discharge</code> \\((0, 1]\\) \u2014 Discharging efficiency \\(\\delta_s\\) <code>Storage.relative_loss_per_hour</code> \\(\\geq 0\\) 1/h Self-discharge rate \\(\\underline{e}_s\\) <code>Storage.relative_minimum_charge_state</code> \\([0, 1]\\) \u2014 Relative min SOC \\(\\bar{e}_s\\) <code>Storage.relative_maximum_charge_state</code> \\([0, 1]\\) \u2014 Relative max SOC \\(a_{f}\\) <code>Converter.conversion_factors</code> \\(\\mathbb{R}\\) \u2014 Conversion coefficient \\(w_t\\) weights \\(&gt; 0\\) \u2014 Timestep weight \\(\\Delta t_t\\) dt \\(&gt; 0\\) h Timestep duration"},{"location":"math/notation/#naming-conventions","title":"Naming Conventions","text":"Convention Meaning Example Uppercase Latin Decision variables \\(P\\) (power/flow rate), \\(E\\) (stored energy) Lowercase Latin Relative/dimensionless parameters \\(\\underline{p}\\) (rel. min), \\(\\bar{p}\\) (rel. max) Greek Physical properties \\(\\eta\\) (efficiency), \\(\\delta\\) (loss rate) Overbar / underbar Bounds \\(\\bar{P}\\) (capacity), \\(\\underline{P}\\) (lower bound) Subscripts Indexing \\(f\\) (flow), \\(t\\) (time), \\(s\\) (storage), \\(b\\) (bus), \\(k\\) (effect) Superscripts Qualification \\(\\eta^{\\text{c}}\\) (charge), \\(\\eta^{\\text{d}}\\) (discharge)"},{"location":"math/objective/","title":"Objective Function","text":""},{"location":"math/objective/#formulation","title":"Formulation","text":"<p>The model minimizes the total value of the designated objective effect \\(k^*\\) (the one with <code>is_objective=True</code>):</p> \\[ \\min \\; \\Phi_{k^*} \\] <p>The total effect aggregates per-timestep contributions weighted by timestep weights:</p> \\[ \\Phi_k = \\sum_{t \\in \\mathcal{T}} \\Phi_{k,t} \\cdot w_t \\] <p>Each per-timestep effect is the sum of flow contributions scaled by duration:</p> \\[ \\Phi_{k,t} = \\sum_{f \\in \\mathcal{F}} c_{f,k,t} \\cdot P_{f,t} \\cdot \\Delta t_t \\]"},{"location":"math/objective/#parameters","title":"Parameters","text":"Symbol Description Reference \\(k^*\\) Objective effect <code>Effect.is_objective = True</code> \\(c_{f,k,t}\\) Effect coefficient per flow-hour <code>Flow.effects_per_flow_hour</code> \\(P_{f,t}\\) Flow rate variable <code>flow_rate[flow, time]</code> \\(\\Delta t_t\\) Timestep duration dt \\(w_t\\) Timestep weight weights \\(\\Phi_{k,t}\\) Per-timestep effect variable <code>effect_per_timestep[effect, time]</code> \\(\\Phi_k\\) Total effect variable <code>effect_total[effect]</code> <p>See Notation for the full symbol table.</p>"},{"location":"math/objective/#example","title":"Example","text":"<p>Consider a gas boiler over 3 timesteps (\\(\\Delta t = 1\\,\\text{h}\\), \\(w = 1\\)):</p> \\(t\\) \\(P_{\\text{gas},t}\\) (MW) \\(c_{\\text{gas,cost}}\\) (\u20ac/MWh) \\(\\Phi_{\\text{cost},t}\\) (\u20ac) 1 2.0 30 \\(30 \\times 2.0 \\times 1 = 60\\) 2 3.0 30 \\(30 \\times 3.0 \\times 1 = 90\\) 3 1.5 30 \\(30 \\times 1.5 \\times 1 = 45\\) <p>Total cost: \\(\\Phi_{\\text{cost}} = 60 + 90 + 45 = 195\\,\\text{\u20ac}\\)</p> <p>The optimizer finds the \\(P_{f,t}\\) values that minimize \\(\\Phi_{k^*}\\) subject to all constraints (bus balance, flow bounds, conversion, storage dynamics).</p>"},{"location":"math/storage/","title":"Storage Dynamics","text":""},{"location":"math/storage/#charge-balance","title":"Charge Balance","text":"<p>The stored energy evolves over time according to charging, discharging, and self-discharge losses:</p> \\[ E_{s,t+1} = E_{s,t} \\left(1 - \\delta_s \\, \\Delta t_t \\right) + P^{\\text{c}}_{s,t} \\, \\eta^{\\text{c}}_s \\, \\Delta t_t - \\frac{P^{\\text{d}}_{s,t}}{\\eta^{\\text{d}}_s} \\, \\Delta t_t \\] <p>where:</p> <ul> <li>\\(E_{s,t}\\) \u2014 stored energy at the start of timestep \\(t\\)</li> <li>\\(P^{\\text{c}}_{s,t}\\) \u2014 charging flow rate (energy entering the storage)</li> <li>\\(P^{\\text{d}}_{s,t}\\) \u2014 discharging flow rate (energy leaving the storage)</li> <li>\\(\\eta^{\\text{c}}_s\\) \u2014 charging efficiency (losses during charging)</li> <li>\\(\\eta^{\\text{d}}_s\\) \u2014 discharging efficiency (losses during discharging)</li> <li>\\(\\delta_s\\) \u2014 self-discharge rate per hour</li> <li>\\(\\Delta t_t\\) \u2014 timestep duration in hours</li> </ul> <p>The charge state has \\(|\\mathcal{T}| + 1\\) values (one before each timestep plus one after the last timestep).</p>"},{"location":"math/storage/#charge-state-bounds","title":"Charge State Bounds","text":"<p>The charge state is bounded by relative SOC limits scaled by the storage capacity:</p> \\[ \\bar{E}_s \\cdot \\underline{e}_s \\leq E_{s,t} \\leq \\bar{E}_s \\cdot \\bar{e}_s \\quad \\forall \\, s, t \\]"},{"location":"math/storage/#initial-cyclic-conditions","title":"Initial &amp; Cyclic Conditions","text":"<p>Fixed initial state:</p> \\[ E_{s,t_0} = E_0 \\] <p>where \\(E_0\\) is <code>Storage.initial_charge_state</code>. If \\(E_0 \\leq 1\\), it is interpreted as a fraction of capacity: \\(E_0 \\cdot \\bar{E}_s\\).</p> <p>Cyclic condition (when <code>initial_charge_state = \"cyclic\"</code>):</p> \\[ E_{s,t_{\\text{end}}} = E_{s,t_0} \\] <p>This ensures the storage ends at the same level it started.</p>"},{"location":"math/storage/#parameters","title":"Parameters","text":"Symbol Description Reference \\(E_{s,t}\\) Stored energy variable <code>charge_state[storage, time]</code> \\(P^{\\text{c}}_{s,t}\\) Charging flow rate <code>flow_rate[charge_flow, time]</code> \\(P^{\\text{d}}_{s,t}\\) Discharging flow rate <code>flow_rate[discharge_flow, time]</code> \\(\\bar{E}_s\\) Storage capacity <code>Storage.capacity</code> \\(\\eta^{\\text{c}}_s\\) Charging efficiency <code>Storage.eta_charge</code> \\(\\eta^{\\text{d}}_s\\) Discharging efficiency <code>Storage.eta_discharge</code> \\(\\delta_s\\) Self-discharge rate <code>Storage.relative_loss_per_hour</code> \\(\\underline{e}_s\\) Relative min SOC <code>Storage.relative_minimum_charge_state</code> \\(\\bar{e}_s\\) Relative max SOC <code>Storage.relative_maximum_charge_state</code> \\(\\Delta t_t\\) Timestep duration dt <p>See Notation for the full symbol table.</p>"},{"location":"math/storage/#example","title":"Example","text":"<p>A battery with \\(\\bar{E} = 10\\) MWh, \\(\\eta^{\\text{c}} = 0.95\\), \\(\\eta^{\\text{d}} = 0.95\\), \\(\\delta = 0.001\\)/h, \\(\\Delta t = 1\\) h:</p> <p>Starting at \\(E_0 = 5\\) MWh, charging at \\(P^{\\text{c}} = 2\\) MW:</p> \\[ E_1 = 5 \\times (1 - 0.001 \\times 1) + 2 \\times 0.95 \\times 1 = 4.995 + 1.9 = 6.895 \\; \\text{MWh} \\]"},{"location":"notebooks/01-quickstart/","title":"Quickstart","text":"In\u00a0[1]: Copied! <pre>from datetime import datetime\n\nimport plotly.express as px\nimport plotly.io as pio\nimport polars as pl\n\nfrom fluxopt import Bus, Converter, Effect, Flow, Port, solve\n\npio.renderers.default = 'notebook_connected'\n</pre> from datetime import datetime  import plotly.express as px import plotly.io as pio import polars as pl  from fluxopt import Bus, Converter, Effect, Flow, Port, solve  pio.renderers.default = 'notebook_connected' <pre>\n---------------------------------------------------------------------------\nModuleNotFoundError                       Traceback (most recent call last)\nCell In[1], line 3\n      1 from datetime import datetime\n----&gt; 3 import plotly.express as px\n      4 import plotly.io as pio\n      5 import polars as pl\n\nModuleNotFoundError: No module named 'plotly'</pre> In\u00a0[2]: Copied! <pre>timesteps = pl.datetime_range(datetime(2024, 1, 15, 8), datetime(2024, 1, 15, 11), interval='1h', eager=True)\ntimesteps\n</pre> timesteps = pl.datetime_range(datetime(2024, 1, 15, 8), datetime(2024, 1, 15, 11), interval='1h', eager=True) timesteps <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[2], line 1\n----&gt; 1 timesteps = pl.datetime_range(datetime(2024, 1, 15, 8), datetime(2024, 1, 15, 11), interval='1h', eager=True)\n      2 timesteps\n\nNameError: name 'pl' is not defined</pre> In\u00a0[3]: Copied! <pre>heat_demand = [30, 50, 45, 25]  # kW per hour\n\npx.bar(x=timesteps, y=heat_demand, labels={'x': 'Time', 'y': 'kW'}, title='Heat Demand')\n</pre> heat_demand = [30, 50, 45, 25]  # kW per hour  px.bar(x=timesteps, y=heat_demand, labels={'x': 'Time', 'y': 'kW'}, title='Heat Demand') <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[3], line 3\n      1 heat_demand = [30, 50, 45, 25]  # kW per hour\n----&gt; 3 px.bar(x=timesteps, y=heat_demand, labels={'x': 'Time', 'y': 'kW'}, title='Heat Demand')\n\nNameError: name 'px' is not defined</pre> In\u00a0[4]: Copied! <pre># Gas supply: up to 1000 kW, costs 0.08 EUR/kWh\ngas_source = Flow(bus='gas', size=1000, effects_per_flow_hour={'cost': 0.08})\n\n# Boiler flows\nfuel = Flow(bus='gas', size=200)\nheat_out = Flow(bus='heat', size=100)\n\n# Heat demand: 50 kW capacity * relative profile = [30, 50, 45, 25] kW\ndemand_flow = Flow(bus='heat', size=50, fixed_relative_profile=[0.6, 1.0, 0.9, 0.5])\n\nresult = solve(\n    timesteps=timesteps,\n    buses=[Bus('gas'), Bus('heat')],\n    effects=[Effect('cost', unit='EUR', is_objective=True)],\n    ports=[\n        Port('gas_grid', imports=[gas_source]),\n        Port('workshop', exports=[demand_flow]),\n    ],\n    converters=[\n        Converter.boiler('boiler', thermal_efficiency=0.9, fuel_flow=fuel, thermal_flow=heat_out),\n    ],\n)\n</pre> # Gas supply: up to 1000 kW, costs 0.08 EUR/kWh gas_source = Flow(bus='gas', size=1000, effects_per_flow_hour={'cost': 0.08})  # Boiler flows fuel = Flow(bus='gas', size=200) heat_out = Flow(bus='heat', size=100)  # Heat demand: 50 kW capacity * relative profile = [30, 50, 45, 25] kW demand_flow = Flow(bus='heat', size=50, fixed_relative_profile=[0.6, 1.0, 0.9, 0.5])  result = solve(     timesteps=timesteps,     buses=[Bus('gas'), Bus('heat')],     effects=[Effect('cost', unit='EUR', is_objective=True)],     ports=[         Port('gas_grid', imports=[gas_source]),         Port('workshop', exports=[demand_flow]),     ],     converters=[         Converter.boiler('boiler', thermal_efficiency=0.9, fuel_flow=fuel, thermal_flow=heat_out),     ], ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[4], line 2\n      1 # Gas supply: up to 1000 kW, costs 0.08 EUR/kWh\n----&gt; 2 gas_source = Flow(bus='gas', size=1000, effects_per_flow_hour={'cost': 0.08})\n      4 # Boiler flows\n      5 fuel = Flow(bus='gas', size=200)\n\nNameError: name 'Flow' is not defined</pre> In\u00a0[5]: Copied! <pre>total_heat = sum(heat_demand)\ngas_consumed = total_heat / 0.9\n\npl.DataFrame(\n    {\n        'Metric': ['Total heat demand', 'Gas consumed', 'Total cost', 'Avg cost of heat'],\n        'Value': [float(total_heat), gas_consumed, result.objective_value, result.objective_value / total_heat],\n        'Unit': ['kWh', 'kWh', 'EUR', 'EUR/kWh'],\n    }\n)\n</pre> total_heat = sum(heat_demand) gas_consumed = total_heat / 0.9  pl.DataFrame(     {         'Metric': ['Total heat demand', 'Gas consumed', 'Total cost', 'Avg cost of heat'],         'Value': [float(total_heat), gas_consumed, result.objective_value, result.objective_value / total_heat],         'Unit': ['kWh', 'kWh', 'EUR', 'EUR/kWh'],     } ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[5], line 4\n      1 total_heat = sum(heat_demand)\n      2 gas_consumed = total_heat / 0.9\n----&gt; 4 pl.DataFrame(\n      5     {\n      6         'Metric': ['Total heat demand', 'Gas consumed', 'Total cost', 'Avg cost of heat'],\n      7         'Value': [float(total_heat), gas_consumed, result.objective_value, result.objective_value / total_heat],\n      8         'Unit': ['kWh', 'kWh', 'EUR', 'EUR/kWh'],\n      9     }\n     10 )\n\nNameError: name 'pl' is not defined</pre> In\u00a0[6]: Copied! <pre>px.line(\n    result.flow_rates,\n    x='time',\n    y='solution',\n    color='flow',\n    title='Flow Rates',\n    labels={'solution': 'kW'},\n    line_shape='hv',\n)\n</pre> px.line(     result.flow_rates,     x='time',     y='solution',     color='flow',     title='Flow Rates',     labels={'solution': 'kW'},     line_shape='hv', ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[6], line 1\n----&gt; 1 px.line(\n      2     result.flow_rates,\n      3     x='time',\n      4     y='solution',\n      5     color='flow',\n      6     title='Flow Rates',\n      7     labels={'solution': 'kW'},\n      8     line_shape='hv',\n      9 )\n\nNameError: name 'px' is not defined</pre> <p>Use <code>flow_rate()</code> to get a single flow's time series:</p> In\u00a0[7]: Copied! <pre>boiler_gas = result.flow_rate('boiler(gas)')\npx.line(\n    boiler_gas,\n    x='time',\n    y='solution',\n    title='Boiler Gas Consumption',\n    labels={'solution': 'kW'},\n    line_shape='hv',\n)\n</pre> boiler_gas = result.flow_rate('boiler(gas)') px.line(     boiler_gas,     x='time',     y='solution',     title='Boiler Gas Consumption',     labels={'solution': 'kW'},     line_shape='hv', ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[7], line 1\n----&gt; 1 boiler_gas = result.flow_rate('boiler(gas)')\n      2 px.line(\n      3     boiler_gas,\n      4     x='time',\n   (...)      8     line_shape='hv',\n      9 )\n\nNameError: name 'result' is not defined</pre> In\u00a0[8]: Copied! <pre>result.effects\n</pre> result.effects <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[8], line 1\n----&gt; 1 result.effects\n\nNameError: name 'result' is not defined</pre> In\u00a0[9]: Copied! <pre>px.bar(\n    result.effects_per_timestep,\n    x='time',\n    y='solution',\n    color='effect',\n    title='Effects per Timestep',\n    labels={'solution': 'EUR'},\n)\n</pre> px.bar(     result.effects_per_timestep,     x='time',     y='solution',     color='effect',     title='Effects per Timestep',     labels={'solution': 'EUR'}, ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[9], line 1\n----&gt; 1 px.bar(\n      2     result.effects_per_timestep,\n      3     x='time',\n      4     y='solution',\n      5     color='effect',\n      6     title='Effects per Timestep',\n      7     labels={'solution': 'EUR'},\n      8 )\n\nNameError: name 'px' is not defined</pre> In\u00a0[10]: Copied! <pre>px.bar(\n    result.contributions,\n    x='time',\n    y='solution',\n    color='contributor',\n    title='Cost Contributions by Flow',\n    labels={'solution': 'EUR'},\n)\n</pre> px.bar(     result.contributions,     x='time',     y='solution',     color='contributor',     title='Cost Contributions by Flow',     labels={'solution': 'EUR'}, ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[10], line 1\n----&gt; 1 px.bar(\n      2     result.contributions,\n      3     x='time',\n      4     y='solution',\n      5     color='contributor',\n      6     title='Cost Contributions by Flow',\n      7     labels={'solution': 'EUR'},\n      8 )\n\nNameError: name 'px' is not defined</pre>"},{"location":"notebooks/01-quickstart/#quickstart","title":"Quickstart\u00b6","text":"<p>Heat a small workshop with a gas boiler \u2014 the minimal working example.</p> <p>This notebook introduces the core concepts of fluxopt:</p> <ul> <li>Bus: Balance nodes where energy flows meet</li> <li>Flow: Energy transfer on a bus \u2014 with size, bounds, and cost coefficients</li> <li>Effect: Quantities to track and optimize (costs, emissions)</li> <li>Port: Sources and sinks connecting the system to the outside world</li> <li>Converter: Linear coupling between input and output flows</li> </ul>"},{"location":"notebooks/01-quickstart/#setup","title":"Setup\u00b6","text":""},{"location":"notebooks/01-quickstart/#define-the-time-horizon","title":"Define the Time Horizon\u00b6","text":"<p>Every optimization needs a time horizon. Here we model a simple 4-hour period:</p>"},{"location":"notebooks/01-quickstart/#define-the-heat-demand","title":"Define the Heat Demand\u00b6","text":"<p>The workshop has varying heat demand throughout the morning:</p>"},{"location":"notebooks/01-quickstart/#build-and-solve-the-energy-system","title":"Build and Solve the Energy System\u00b6","text":"<p>The system has a gas grid, a boiler, and a heat demand:</p> <pre><code>  Gas Grid \u2500\u2500\u25ba [gas bus] \u2500\u2500\u25ba Boiler \u2500\u2500\u25ba [heat bus] \u2500\u2500\u25ba Workshop\n      \u20ac                        \u03b7=90%                    Demand\n</code></pre> <p>In fluxopt, we define Flows (energy on a bus), group them into Ports (sources/sinks) and Converters (coupled flows), then call <code>solve</code>.</p>"},{"location":"notebooks/01-quickstart/#analyze-results","title":"Analyze Results\u00b6","text":""},{"location":"notebooks/01-quickstart/#total-costs","title":"Total Costs\u00b6","text":"<p>The total cost \u2014 the minimized objective:</p>"},{"location":"notebooks/01-quickstart/#flow-rates","title":"Flow Rates\u00b6","text":"<p>Visualize all flow rates over time. Flow ids are qualified as <code>{component}({bus})</code>.</p>"},{"location":"notebooks/01-quickstart/#effect-totals","title":"Effect Totals\u00b6","text":""},{"location":"notebooks/01-quickstart/#per-timestep-effects","title":"Per-Timestep Effects\u00b6","text":"<p>Cost incurred at each timestep:</p>"},{"location":"notebooks/01-quickstart/#contributions","title":"Contributions\u00b6","text":"<p>Which flows contributed to which effects:</p>"},{"location":"notebooks/01-quickstart/#summary","title":"Summary\u00b6","text":"<p>The basic workflow:</p> <ol> <li>Define flows with size, bounds, and cost coefficients</li> <li>Group flows into ports (sources/sinks) and converters</li> <li>Solve with <code>solve(timesteps, buses, effects, ports, converters)</code></li> <li>Inspect results via <code>result.flow_rates</code>, <code>result.effects</code>, <code>result.contributions</code></li> </ol>"},{"location":"notebooks/01-quickstart/#next-steps","title":"Next Steps\u00b6","text":"<ul> <li>02-heat-system: Add thermal storage to shift loads with time-varying prices</li> </ul>"},{"location":"notebooks/02-heat-system/","title":"Heat System with Storage","text":"In\u00a0[1]: Copied! <pre>import math\nfrom datetime import datetime, timedelta\n\nimport plotly.express as px\nimport plotly.io as pio\nimport polars as pl\n\nfrom fluxopt import Bus, Converter, Effect, Flow, Port, Storage, solve\n\npio.renderers.default = 'notebook_connected'\n</pre> import math from datetime import datetime, timedelta  import plotly.express as px import plotly.io as pio import polars as pl  from fluxopt import Bus, Converter, Effect, Flow, Port, Storage, solve  pio.renderers.default = 'notebook_connected' <pre>\n---------------------------------------------------------------------------\nModuleNotFoundError                       Traceback (most recent call last)\nCell In[1], line 4\n      1 import math\n      2 from datetime import datetime, timedelta\n----&gt; 4 import plotly.express as px\n      5 import plotly.io as pio\n      6 import polars as pl\n\nModuleNotFoundError: No module named 'plotly'</pre> In\u00a0[2]: Copied! <pre>n_hours = 48\ntimesteps = pl.datetime_range(\n    datetime(2024, 1, 15), datetime(2024, 1, 15) + timedelta(hours=n_hours - 1), interval='1h', eager=True\n)\n\n# Heat demand: sinusoidal pattern - peaks during business hours, low at night\nheat_demand = [50 + 40 * max(0.0, math.sin(math.pi * ((h % 24) - 6) / 12)) for h in range(n_hours)]\n\n# Gas price: off-peak (22:00-06:00) at 0.04 EUR/kWh, peak at 0.08 EUR/kWh\ngas_price = [0.04 if (h % 24) &lt; 6 or (h % 24) &gt;= 22 else 0.08 for h in range(n_hours)]\n</pre> n_hours = 48 timesteps = pl.datetime_range(     datetime(2024, 1, 15), datetime(2024, 1, 15) + timedelta(hours=n_hours - 1), interval='1h', eager=True )  # Heat demand: sinusoidal pattern - peaks during business hours, low at night heat_demand = [50 + 40 * max(0.0, math.sin(math.pi * ((h % 24) - 6) / 12)) for h in range(n_hours)]  # Gas price: off-peak (22:00-06:00) at 0.04 EUR/kWh, peak at 0.08 EUR/kWh gas_price = [0.04 if (h % 24) &lt; 6 or (h % 24) &gt;= 22 else 0.08 for h in range(n_hours)] <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[2], line 2\n      1 n_hours = 48\n----&gt; 2 timesteps = pl.datetime_range(\n      3     datetime(2024, 1, 15), datetime(2024, 1, 15) + timedelta(hours=n_hours - 1), interval='1h', eager=True\n      4 )\n      6 # Heat demand: sinusoidal pattern - peaks during business hours, low at night\n      7 heat_demand = [50 + 40 * max(0.0, math.sin(math.pi * ((h % 24) - 6) / 12)) for h in range(n_hours)]\n\nNameError: name 'pl' is not defined</pre> <p>Visualize the demand and price profiles:</p> In\u00a0[3]: Copied! <pre>px.line(x=timesteps, y=heat_demand, labels={'x': 'Time', 'y': 'kW'}, title='Heat Demand')\n</pre> px.line(x=timesteps, y=heat_demand, labels={'x': 'Time', 'y': 'kW'}, title='Heat Demand') <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[3], line 1\n----&gt; 1 px.line(x=timesteps, y=heat_demand, labels={'x': 'Time', 'y': 'kW'}, title='Heat Demand')\n\nNameError: name 'px' is not defined</pre> In\u00a0[4]: Copied! <pre>px.line(x=timesteps, y=gas_price, labels={'x': 'Time', 'y': 'EUR/kWh'}, title='Gas Price')\n</pre> px.line(x=timesteps, y=gas_price, labels={'x': 'Time', 'y': 'EUR/kWh'}, title='Gas Price') <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[4], line 1\n----&gt; 1 px.line(x=timesteps, y=gas_price, labels={'x': 'Time', 'y': 'EUR/kWh'}, title='Gas Price')\n\nNameError: name 'px' is not defined</pre> In\u00a0[5]: Copied! <pre># Gas supply with time-varying price\ngas_source = Flow(bus='gas', size=500, effects_per_flow_hour={'cost': gas_price})\n\n# Boiler: 150 kW thermal capacity, 92% efficiency\nfuel = Flow(bus='gas', size=300)\nheat_out = Flow(bus='heat', size=150)\n\n# Demand: normalize to relative profile\nmax_demand = max(heat_demand)\ndemand_profile = [d / max_demand for d in heat_demand]\ndemand_flow = Flow(bus='heat', size=max_demand, fixed_relative_profile=demand_profile)\n\n# Thermal storage: 500 kWh, 98% charge/discharge efficiency, 0.5%/h self-discharge\ncharge_flow = Flow(bus='heat', size=100)\ndischarge_flow = Flow(bus='heat', size=100)\nstorage = Storage(\n    'thermal_storage',\n    charging=charge_flow,\n    discharging=discharge_flow,\n    capacity=500,\n    eta_charge=0.98,\n    eta_discharge=0.98,\n    relative_loss_per_hour=0.005,\n    initial_charge_state=0.5,  # start half-full (fraction of capacity)\n)\n\nresult = solve(\n    timesteps=timesteps,\n    buses=[Bus('gas'), Bus('heat')],\n    effects=[Effect('cost', unit='\u20ac', is_objective=True)],\n    ports=[\n        Port('gas_grid', imports=[gas_source]),\n        Port('office', exports=[demand_flow]),\n    ],\n    converters=[\n        Converter.boiler('boiler', thermal_efficiency=0.92, fuel_flow=fuel, thermal_flow=heat_out),\n    ],\n    storages=[storage],\n)\n</pre> # Gas supply with time-varying price gas_source = Flow(bus='gas', size=500, effects_per_flow_hour={'cost': gas_price})  # Boiler: 150 kW thermal capacity, 92% efficiency fuel = Flow(bus='gas', size=300) heat_out = Flow(bus='heat', size=150)  # Demand: normalize to relative profile max_demand = max(heat_demand) demand_profile = [d / max_demand for d in heat_demand] demand_flow = Flow(bus='heat', size=max_demand, fixed_relative_profile=demand_profile)  # Thermal storage: 500 kWh, 98% charge/discharge efficiency, 0.5%/h self-discharge charge_flow = Flow(bus='heat', size=100) discharge_flow = Flow(bus='heat', size=100) storage = Storage(     'thermal_storage',     charging=charge_flow,     discharging=discharge_flow,     capacity=500,     eta_charge=0.98,     eta_discharge=0.98,     relative_loss_per_hour=0.005,     initial_charge_state=0.5,  # start half-full (fraction of capacity) )  result = solve(     timesteps=timesteps,     buses=[Bus('gas'), Bus('heat')],     effects=[Effect('cost', unit='\u20ac', is_objective=True)],     ports=[         Port('gas_grid', imports=[gas_source]),         Port('office', exports=[demand_flow]),     ],     converters=[         Converter.boiler('boiler', thermal_efficiency=0.92, fuel_flow=fuel, thermal_flow=heat_out),     ],     storages=[storage], ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[5], line 2\n      1 # Gas supply with time-varying price\n----&gt; 2 gas_source = Flow(bus='gas', size=500, effects_per_flow_hour={'cost': gas_price})\n      4 # Boiler: 150 kW thermal capacity, 92% efficiency\n      5 fuel = Flow(bus='gas', size=300)\n\nNameError: name 'Flow' is not defined</pre> In\u00a0[6]: Copied! <pre>total_heat = sum(heat_demand)\n\npl.DataFrame(\n    {\n        'Metric': ['Total heat delivered', 'Total cost', 'Avg cost of heat'],\n        'Value': [total_heat, result.objective_value, result.objective_value / total_heat * 100],\n        'Unit': ['kWh', 'EUR', 'ct/kWh'],\n    }\n)\n</pre> total_heat = sum(heat_demand)  pl.DataFrame(     {         'Metric': ['Total heat delivered', 'Total cost', 'Avg cost of heat'],         'Value': [total_heat, result.objective_value, result.objective_value / total_heat * 100],         'Unit': ['kWh', 'EUR', 'ct/kWh'],     } ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[6], line 1\n----&gt; 1 total_heat = sum(heat_demand)\n      3 pl.DataFrame(\n      4     {\n      5         'Metric': ['Total heat delivered', 'Total cost', 'Avg cost of heat'],\n   (...)      8     }\n      9 )\n\nNameError: name 'heat_demand' is not defined</pre> In\u00a0[7]: Copied! <pre>px.line(\n    result.flow_rates,\n    x='time',\n    y='solution',\n    color='flow',\n    title='Flow Rates',\n    labels={'solution': 'kW'},\n    line_shape='hv',\n)\n</pre> px.line(     result.flow_rates,     x='time',     y='solution',     color='flow',     title='Flow Rates',     labels={'solution': 'kW'},     line_shape='hv', ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[7], line 1\n----&gt; 1 px.line(\n      2     result.flow_rates,\n      3     x='time',\n      4     y='solution',\n      5     color='flow',\n      6     title='Flow Rates',\n      7     labels={'solution': 'kW'},\n      8     line_shape='hv',\n      9 )\n\nNameError: name 'px' is not defined</pre> In\u00a0[8]: Copied! <pre>storage_flows = result.flow_rates.filter(pl.col('flow').str.starts_with('thermal_storage'))\npx.line(\n    storage_flows,\n    x='time',\n    y='solution',\n    color='flow',\n    title='Storage Charge / Discharge',\n    labels={'solution': 'kW'},\n    line_shape='hv',\n)\n</pre> storage_flows = result.flow_rates.filter(pl.col('flow').str.starts_with('thermal_storage')) px.line(     storage_flows,     x='time',     y='solution',     color='flow',     title='Storage Charge / Discharge',     labels={'solution': 'kW'},     line_shape='hv', ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[8], line 1\n----&gt; 1 storage_flows = result.flow_rates.filter(pl.col('flow').str.starts_with('thermal_storage'))\n      2 px.line(\n      3     storage_flows,\n      4     x='time',\n   (...)      9     line_shape='hv',\n     10 )\n\nNameError: name 'result' is not defined</pre> In\u00a0[9]: Copied! <pre>cs = result.charge_state('thermal_storage')\npx.area(cs, x='time', y='solution', title='Storage Charge State', labels={'solution': 'kWh'}, line_shape='hv')\n</pre> cs = result.charge_state('thermal_storage') px.area(cs, x='time', y='solution', title='Storage Charge State', labels={'solution': 'kWh'}, line_shape='hv') <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[9], line 1\n----&gt; 1 cs = result.charge_state('thermal_storage')\n      2 px.area(cs, x='time', y='solution', title='Storage Charge State', labels={'solution': 'kWh'}, line_shape='hv')\n\nNameError: name 'result' is not defined</pre> In\u00a0[10]: Copied! <pre>heat_flows = result.flow_rates.filter(pl.col('flow').str.contains('heat|charge|discharge'))\npx.line(\n    heat_flows,\n    x='time',\n    y='solution',\n    color='flow',\n    title='Heat Bus Balance',\n    labels={'solution': 'kW'},\n    line_shape='hv',\n)\n</pre> heat_flows = result.flow_rates.filter(pl.col('flow').str.contains('heat|charge|discharge')) px.line(     heat_flows,     x='time',     y='solution',     color='flow',     title='Heat Bus Balance',     labels={'solution': 'kW'},     line_shape='hv', ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[10], line 1\n----&gt; 1 heat_flows = result.flow_rates.filter(pl.col('flow').str.contains('heat|charge|discharge'))\n      2 px.line(\n      3     heat_flows,\n      4     x='time',\n   (...)      9     line_shape='hv',\n     10 )\n\nNameError: name 'result' is not defined</pre> In\u00a0[11]: Copied! <pre>px.bar(\n    result.contributions,\n    x='time',\n    y='solution',\n    color='contributor',\n    title='Cost Contributions by Flow',\n    labels={'solution': 'EUR'},\n)\n</pre> px.bar(     result.contributions,     x='time',     y='solution',     color='contributor',     title='Cost Contributions by Flow',     labels={'solution': 'EUR'}, ) <pre>\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\nCell In[11], line 1\n----&gt; 1 px.bar(\n      2     result.contributions,\n      3     x='time',\n      4     y='solution',\n      5     color='contributor',\n      6     title='Cost Contributions by Flow',\n      7     labels={'solution': 'EUR'},\n      8 )\n\nNameError: name 'px' is not defined</pre>"},{"location":"notebooks/02-heat-system/#heat-system-with-storage","title":"Heat System with Storage\u00b6","text":"<p>District heating with a thermal storage tank and time-varying gas prices.</p> <p>This notebook introduces:</p> <ul> <li>Storage: Thermal buffer with charge/discharge flows, efficiency, and self-discharge</li> <li>Time-varying prices: Cost coefficients that change per timestep</li> <li>Load shifting: The optimizer charges storage when gas is cheap and discharges when expensive</li> </ul>"},{"location":"notebooks/02-heat-system/#setup","title":"Setup\u00b6","text":""},{"location":"notebooks/02-heat-system/#generate-time-series-data","title":"Generate Time Series Data\u00b6","text":"<p>We model 48 hours with hourly resolution. Heat demand follows a day/night pattern, and gas prices have off-peak/peak tariffs.</p>"},{"location":"notebooks/02-heat-system/#build-and-solve-the-energy-system","title":"Build and Solve the Energy System\u00b6","text":"<p>The system:</p> <pre><code>Gas Grid \u2500\u2500\u25ba [gas] \u2500\u2500\u25ba Boiler \u2500\u2500\u25ba [heat] \u25c4\u2500\u2500\u25ba Storage\n                         \u03b7=92%       \u2502\n                                     \u25bc\n                                   Office\n</code></pre>"},{"location":"notebooks/02-heat-system/#analyze-results","title":"Analyze Results\u00b6","text":""},{"location":"notebooks/02-heat-system/#cost-summary","title":"Cost Summary\u00b6","text":""},{"location":"notebooks/02-heat-system/#flow-rates","title":"Flow Rates\u00b6","text":"<p>All flow rates across the horizon:</p>"},{"location":"notebooks/02-heat-system/#storage-operation","title":"Storage Operation\u00b6","text":"<p>Charge and discharge rates show the load-shifting behavior:</p>"},{"location":"notebooks/02-heat-system/#charge-state","title":"Charge State\u00b6","text":"<p>The stored energy over time:</p>"},{"location":"notebooks/02-heat-system/#heat-balance","title":"Heat Balance\u00b6","text":"<p>How boiler output and storage work together to meet demand:</p>"},{"location":"notebooks/02-heat-system/#effect-contributions","title":"Effect Contributions\u00b6","text":"<p>Breakdown of which flows drive cost:</p>"},{"location":"notebooks/02-heat-system/#key-insights","title":"Key Insights\u00b6","text":"<p>The optimization reveals how storage enables load shifting:</p> <ol> <li>Charge during off-peak: When gas is cheap (night), the boiler runs at higher output to charge the storage</li> <li>Discharge during peak: During expensive periods, storage supplements the boiler, reducing gas purchases</li> <li>Efficiency trade-off: Storage has round-trip losses (0.98 \u00d7 0.98 = 96%) plus self-discharge, so shifting only happens when the price spread exceeds the loss cost</li> </ol>"},{"location":"notebooks/02-heat-system/#summary","title":"Summary\u00b6","text":"<p>You learned how to:</p> <ul> <li>Add Storage with capacity, efficiency, and self-discharge</li> <li>Use time-varying prices via <code>effects_per_flow_hour</code></li> <li>Inspect charge states and storage operation</li> <li>Join result DataFrames for combined analysis</li> </ul>"}]}